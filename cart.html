<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrderNow - Cart</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #706565;
        }
        
        nav {
            background-color: #333;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .logo img {
            height: 40px;
            width: auto;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .nav-links a:hover {
            color: #ff6b6b;
        }
        
        .auth-buttons {
            display: flex;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .btn-login {
            background-color: transparent;
            color: white;
            border: 2px solid white;
        }
        
        .btn-signup {
            background-color: #ff6b6b;
            color: white;
        }
        
        .btn-logout {
            background-color: #ff6b6b;
            color: white;
        }
        
        .user-greeting {
            color: white;
            font-size: 0.9rem;
            margin-right: 1rem;
        }
        
        .btn:hover {
            opacity: 0.8;
        }

        .cart-content {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: calc(100vh - 180px);
            padding: 2rem;
        }

        .checkout-wrapper {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 1.5rem;
            width: 100%;
            max-width: 1100px;
        }

        @media (max-width: 880px) {
            .checkout-wrapper { grid-template-columns: 1fr; }
        }

        .order-summary, .checkout-form {
            background: #fff;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.06);
        }

        .order-summary h1 { margin: 0 0 0.5rem; }
        .items { display:flex;flex-direction:column;gap:0.75rem;margin-top:1rem; }
        .item{display:flex;align-items:center;justify-content:space-between;padding:0.6rem;border-radius:6px;border:1px solid #f0f0f0}
        .item .meta{flex:1;margin-left:0.75rem}
        .item .title{font-weight:600}
        .qty{display:flex;gap:0.5rem;align-items:center}
        .qty input{width:56px;padding:0.25rem;text-align:center}
        .remove{background:transparent;border:none;color:#666;cursor:pointer}
        .summary-footer{margin-top:1rem;border-top:1px dashed #eee;padding-top:0.75rem;text-align:right}
        .checkout-form label{display:block;margin-bottom:0.75rem}
        .checkout-form input[type=text], .checkout-form input[type=email]{width:100%;padding:0.5rem;border:1px solid #ddd;border-radius:6px}
        .card fieldset{border:1px solid #eee;padding:0.5rem;border-radius:6px;margin:0 0 0.75rem}
        .card-row{display:flex;gap:0.5rem}
        .form-actions{margin-top:0.75rem;text-align:right}
        .btn-primary{background:#ff6b6b;border:none;color:#fff;padding:0.6rem 1rem;border-radius:6px;cursor:pointer}
        .btn-primary:disabled{opacity:0.6;cursor:not-allowed}
        .message{margin-top:0.75rem;color:green;font-weight:600}

        .cart-badge {
            display: inline-block;
            min-width: 20px;
            padding: 2px 6px;
            font-size: 0.8rem;
            line-height: 1;
            text-align: center;
            border-radius: 999px;
            background: #ff6b6b;
            color: white;
            margin-left: 6px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <nav>
        <div class="logo"><img src="logo2.png" alt="OrderNow Logo">OrderNow</div>
        <ul class="nav-links">
            <li><a href="navigation.html">Home</a></li>
            <li><a href="cart.html">Cart <span id="cartCount" class="cart-badge">0</span></a></li>
            <li><a href="aboutpage.html">About</a></li>
        </ul>
        <div class="auth-buttons" id="authButtons">
            
        </div>
    </nav>

     <div class="cart-content">
        <div class="checkout-wrapper">
            <section class="order-summary">
                <h1>Cart</h1>
                <div class="divider"></div>
                <div id="cartItems" class="items"></div>
                <div class="summary-footer">
                    <div>Subtotal: <span id="subtotal">$0.00</span></div>
                    <div>Tax (8%): <span id="tax">$0.00</span></div>
                    <div class="total">Total: <strong id="total">$0.00</strong></div>
                </div>
            </section>

            <section class="checkout-form">
                <h2>Checkout</h2>
                <form id="checkoutForm" novalidate>
                    <label>Name
                        <input type="text" id="name" required>
                    </label>
                    <label>Email
                        <input type="email" id="email" required>
                    </label>
                    <label>Address
                        <input type="text" id="address" required>
                    </label>

                    <fieldset class="card">
                        <legend>Card</legend>
                        <label>Card number
                            <input type="text" id="cardNumber" inputmode="numeric" maxlength="19" placeholder="4242 4242 4242 4242" required>
                        </label>
                        <div class="card-row">
                            <label>Expiry (MM/YY)
                                <input type="text" id="expiry" maxlength="5" placeholder="MM/YY" required>
                            </label>
                            <label>CVV
                                <input type="text" id="cvv" maxlength="4" inputmode="numeric" required>
                            </label>
                        </div>
                    </fieldset>

                    <div class="form-actions">
                        <button type="button" id="payBtn" class="btn-primary">Pay <span id="payAmount">$0.00</span></button>
                    </div>
                </form>
                <div id="message" class="message" role="status" aria-live="polite"></div>
            </section>
        </div>
    </div>

    <script>
        const loggedInUser = localStorage.getItem('loggedInUser');
        const authButtons = document.getElementById('authButtons');
        
        if (loggedInUser) {
            authButtons.innerHTML = `
                <span class="user-greeting">Welcome, ${loggedInUser}!</span>
                <button class="btn btn-logout" onclick="logout()">Logout</button>
            `;
        } else {
            authButtons.innerHTML = `
                <button class="btn btn-login" onclick="window.location.href='Login.html'">Login</button>
                <button class="btn btn-signup" onclick="window.location.href='signup.html'">Sign Up</button>
            `;
        }

        function logout() {
            localStorage.removeItem('loggedInUser');
            window.location.href = 'navigation.html';
        }

        const CART_KEY = 'orderNowCart';

        function getCart() { return JSON.parse(localStorage.getItem(CART_KEY) || '[]'); }
        function saveCart(cart) { localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
        function currency(v) { return `$${v.toFixed(2)}`; }

        function renderCart() {
            const cart = getCart();
            const itemsEl = document.getElementById('cartItems');
            if (!cart.length) {
                itemsEl.innerHTML = '<div class="small">Your cart is empty. <a href="navigation.html">Go back to menu</a></div>';
                document.getElementById('payBtn').disabled = true;
                updateTotals();
                return;
            }

            itemsEl.innerHTML = cart.map(i => `
                <div class="item" data-id="${i.id}">
                  <div class="meta">
                    <div class="title">${i.title}</div>
                    <div class="small">${currency(i.price)} each</div>
                  </div>
                  <div class="qty">
                    <input type="number" min="1" value="${i.qty}" class="qtyInput">
                    <button class="remove">Remove</button>
                  </div>
                </div>
            `).join('');

            itemsEl.querySelectorAll('.qtyInput').forEach(el => {
                el.addEventListener('change', e => {
                    const newQty = Math.max(1, parseInt(e.target.value) || 1);
                    const li = e.target.closest('.item');
                    const id = li.dataset.id;
                    const cart = getCart();
                    const entry = cart.find(x => x.id === id);
                    if (entry) { entry.qty = newQty; saveCart(cart); updateTotals(); updateNavCount(); }
                    e.target.value = newQty;
                });
            });

            itemsEl.querySelectorAll('.remove').forEach(btn => btn.addEventListener('click', e => {
                const id = e.target.closest('.item').dataset.id;
                let cart = getCart(); cart = cart.filter(x => x.id !== id); saveCart(cart); renderCart(); updateNavCount();
            }));

            updateTotals();
        }

        function updateTotals() {
            const cart = getCart();
            const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0);
            const tax = subtotal * 0.08; // 8%
            const total = subtotal + tax;
            document.getElementById('subtotal').textContent = currency(subtotal);
            document.getElementById('tax').textContent = currency(tax);
            document.getElementById('total').textContent = currency(total);
            const payBtn = document.getElementById('payBtn'); if (payBtn) payBtn.disabled = cart.length === 0;
            document.getElementById('payAmount').textContent = currency(total);
        }

        function updateNavCount() {
            const cart = getCart();
            const totalQty = cart.reduce((s, i) => s + i.qty, 0);
            const el = document.getElementById('cartCount'); if (el) el.textContent = totalQty;
        }

        function validateForm() {
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const address = document.getElementById('address').value.trim();
            const card = document.getElementById('cardNumber').value.replace(/\s+/g, '');
            const expiry = document.getElementById('expiry').value.trim();
            const cvv = document.getElementById('cvv').value.trim();

            if (!name || !email || !address) return 'Please complete contact fields.';
            if (!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) return 'Enter a valid email.';
            if (!/^\d{12,19}$/.test(card)) return 'Enter a valid card number (12-19 digits).';
            if (!/^\d{2}\/\d{2}$/.test(expiry)) return 'Expiry must be in MM/YY format.';
            if (!/^\d{3,4}$/.test(cvv)) return 'Enter a valid CVV.';
            return null;
        }

        function clearForm() { ['name', 'email', 'address', 'cardNumber', 'expiry', 'cvv'].forEach(id => document.getElementById(id).value = ''); }
        function showMessage(msg, success = true) { const el = document.getElementById('message'); el.textContent = msg; el.style.color = success ? 'green' : 'red'; }

        function simulatePayment() {
            const payBtn = document.getElementById('payBtn');
            payBtn.disabled = true; payBtn.textContent = 'Processing...'; showMessage('Processing payment...');
            setTimeout(() => {
                saveCart([]);
                renderCart(); updateNavCount(); clearForm();
                showMessage('Payment successful! Thank you for your order.');
                payBtn.disabled = false; payBtn.textContent = `Pay ${document.getElementById('payAmount').textContent}`;
            }, 1200);
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderCart(); updateNavCount();
            const payBtn = document.getElementById('payBtn'); if (payBtn) payBtn.addEventListener('click', () => {
                const err = validateForm(); if (err) { showMessage(err, false); return; } simulatePayment();
            });
        });
    </script>
</body>
</html>